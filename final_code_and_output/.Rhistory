library(dplyr)
source('../main_sim/fns_sim.R')
pL_geom_1M <- function(l, psi, phi, M) {
if (l == 1) {return(phi*psi/(phi*psi + psi^2*(1 - phi - (1 - phi)^M)))}
else {return(phi*(1-phi)^(l-1)*psi^2/(phi*psi + psi^2*(1 - phi - (1 - phi)^M)))}
}
get_exp_freq_1M <- function(psi, phi, M) {
density <- lapply(1:1500, pL_geom_1M, psi, phi, M) %>% unlist()
return(density)
}
get_exp_freq_2M <- function(psi, phi, M) {
density <- lapply(2:1500, pL_geom_2M, psi, phi, M) %>% unlist()
return(density)
}
sim.0.5 <- readRDS("../main_sim/res.sim.2M.1500.region.5000.ibdclust2cM.MAF.0.5.boot.keep.ends.rds")
tracts <- lapply(sim.0.5, function(x) {return(x[[3]])}) %>% unlist() %>% matrix(byrow = TRUE, ncol = 2)
psi <- lapply(sim.0.5, function(x){return(x[[4]])}) %>% unlist()
sim.tracts <- readRDS("../sim_tracts/res.geom.rds")
sim.tracts.l <- lapply(sim.tracts, function(x) {return(x[[4]])}) %>% unlist()
sim.tracts.psi <- lapply(sim.tracts, function(x){return(x[[5]])}) %>% unlist()
### General outline for LD section
#1. expected CDF not equal to empirical CDF in main simulation
#2. empirical CDF in main simulation is equal to empirical CDF when simulating from the vcf file
#3. expected CDF is equal to empirical CDF when simulating tracts without LD
#4. truncated expected CDF is equal to truncated empirical CDF in main simulation
#1
# expected CDF in main simulation
sim.exp.freq.1M <- lapply(psi, get_exp_freq_1M, 1/300, 1500)
sim.obs.cnts <- split(tracts, seq(nrow(tracts))) %>% lapply(function(x) {x[[2]] - x[[1]] + 1}) %>% as.data.frame() %>% t()
colnames(sim.obs.cnts) = "l"
sim.obs.cnts <- as.data.frame(sim.obs.cnts)
sim.obs.cnts.df <- sim.obs.cnts %>% group_by(l) %>% summarize(counts = n())
